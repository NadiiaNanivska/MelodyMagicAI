# 3.2 Система Управління Файлами

## 3.2.1 Архітектура Файлового Менеджера

У системі реалізовано автоматизований менеджмент файлів для ефективної обробки MIDI-файлів. Структура включає два основних директорії:

```python
TEMP_DIR = "./generated_midis"     # Для згенерованих файлів
UPLOAD_FOLDER = "./uploaded_midis"  # Для завантажених файлів
```

## 3.2.2 Механізми Очистки

Система включає автоматичний механізм очистки тимчасових файлів, який запускається при старті додатку:

```python
async def lifespan(app: FastAPI):
    await asyncio.to_thread(clean_old_files)
    yield
```

Реалізовано наступні механізми:
- Автоматичне видалення старих файлів
- Видалення файлів після завантаження
- Створення унікальних імен файлів з часовими мітками

## 3.2.3 Безпека та Валідація

Система забезпечує:
- Перевірку розширення файлів (.mid)
- Контроль розміру файлів
- Безпечне зберігання в ізольованих директоріях
- Логування всіх операцій з файлами

## 3.2.4 API Ендпоінти Файлового Менеджера

Реалізовано три основні ендпоінти:
1. `/upload_midi` - завантаження MIDI файлів
2. `/download/{filename}` - завантаження з автоматичним видаленням
3. `/preview/{filename}` - попередній перегляд без видалення

Ця архітектура забезпечує ефективну та безпечну обробку файлів у системі, з автоматичним керуванням життєвим циклом тимчасових файлів.
